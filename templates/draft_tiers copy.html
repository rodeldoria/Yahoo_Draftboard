<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Champs - Player Tiers</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .banner {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }

        .form-inline {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px;
        }

        .compact-input {
            padding: 5px;
            font-size: 14px;
            border: 1px solid #444;
            border-radius: 5px;
            background-color: #333;
            color: #fff;
        }

        .compact-button {
            padding: 5px 10px;
            font-size: 14px;
            border: 1px solid #444;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
        }

        .compact-button:hover {
            background-color: #555;
        }

        .tier-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, auto);
            gap: 20px;
            margin: 20px;
        }

        .position-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .highlight-light-green {
            background-color: lightgreen;
        }

        .highlight-light-gold {
            background-color: gold;
        }

        .highlight-light-red {
            background-color: lightcoral;
        }

        .highlight-light-purple {
            background-color: plum;
        }

        .tier-list span.material-symbols-outlined {
            cursor: pointer;
            margin: 0 2px;
            font-size: 18px;
        }

        .tier-list span.material-symbols-outlined:hover {
            opacity: 0.7;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: none;
            margin: 10px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body>
    <div class="banner">Fantasy Champs - Player Tiers</div>
    <div class="form-inline">
        <form id="uploadForm" enctype="multipart/form-data">
            <input type="file" name="file" id="fileInput" accept=".pdf" class="compact-input">
            <input type="submit" value="Upload" class="compact-button">
        </form>
    </div>

    <div id="loader" class="loader"></div>

    <div id="tier-list" class="tier-list"></div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const formData = new FormData(this);
            const loader = document.getElementById('loader');
            
            // Show the loader
            loader.style.display = 'block';

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Uploaded data:', data);
                    displayTierList(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while uploading the file.');
                })
                .finally(() => {
                    // Hide the loader
                    loader.style.display = 'none';
                });
        });

        function displayTierList(data) {
            const tierListDiv = document.getElementById('tier-list');
            tierListDiv.innerHTML = ''; // Clear existing data

            const positions = ["QB", "RB", "WR", "TE", "DEF", "K"];
            positions.forEach(position => {
                if (data[position] && data[position].length > 0) {
                    const positionGroup = document.createElement('div');
                    positionGroup.className = 'position-group';
                    positionGroup.innerHTML = `<h2>${position}</h2>`;

                    const table = document.createElement('table');
                    table.style.borderCollapse = 'collapse';
                    table.innerHTML = `
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Name</th>
                                <th>Team</th>
                                <th>ADP</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    `;

                    data[position].forEach(player => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${player.Rank || ''}</td>
                            <td class="player-name">${player.Name || ''}</td>
                            <td>${player.Team || ''}</td>
                            <td>${player.ADP || ''}</td>
                            <td>
                                <span class="material-symbols-outlined action-icon" data-action="check">check_circle</span>
                                <span class="material-symbols-outlined action-icon" data-action="star">star</span>
                                <span class="material-symbols-outlined action-icon" data-action="close">close</span>
                                <span class="material-symbols-outlined action-icon" data-action="lock">lock</span>
                            </td>
                        `;
                        table.querySelector('tbody').appendChild(row);
                    });

                    positionGroup.appendChild(table);
                    tierListDiv.appendChild(positionGroup);
                }
            });

            // Add event listeners to action icons
            document.querySelectorAll('.action-icon').forEach(icon => {
                icon.addEventListener('click', function() {
                    const action = this.getAttribute('data-action');
                    let color;
                    switch(action) {
                        case 'check':
                            color = 'light-green';
                            break;
                        case 'star':
                            color = 'light-gold';
                            break;
                        case 'close':
                            color = 'light-red';
                            break;
                        case 'lock':
                            color = 'light-purple';
                            break;
                    }
                    highlightCell(this, color);
                });
            });
        }

        function highlightCell(icon, color) {
            const row = icon.closest('tr');
            row.classList.remove('highlight-light-green', 'highlight-light-gold', 'highlight-light-red', 'highlight-light-purple');
            
            switch(color) {
                case 'light-green':
                    row.style.display = 'none';
                    break;
                case 'light-gold':
                    row.classList.add('highlight-light-gold');
                    break;
                case 'light-red':
                    row.classList.add('highlight-light-red');
                    break;
                case 'light-purple':
                    row.classList.add('highlight-light-purple');
                    break;
            }
        }

        function hideDraftedPlayer(playerName) {
            const tierListDiv = document.getElementById('tier-list');
            const playerRows = tierListDiv.querySelectorAll('tr');
            
            playerRows.forEach(row => {
                const nameCell = row.querySelector('.player-name');
                if (nameCell && nameCell.textContent.trim() === playerName) {
                    row.style.display = 'none';
                }
            });
        }

        // Modify the fetchDraftResults function to call hideDraftedPlayer for each drafted player
        async function fetchDraftResults() {
            // ... (existing code) ...

            for (const round in rounds) {
                // ... (existing code) ...

                for (const player of rounds[round]) {
                    const playerInfo = playerDetails[player.player_id];
                    if (playerInfo) {
                        // ... (existing code to create player card and add to draft results table) ...

                        // Hide the drafted player in the tier list
                        hideDraftedPlayer(playerInfo.name.full);
                    }
                }
            }

            // ... (existing code) ...
        }
    </script>
</body>

</html>